<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button></ion-back-button>
        </ion-buttons>
        <ion-title>找回密码</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content>
    <form class="padding-20" [formGroup]="form">
        <mat-form-field class="width-100" appearance="legacy">
            <span matPrefix>账号 &nbsp;</span>
            <input matInput placeholder="账号" formControlName="account">
            <button class="verify-code" mat-stroked-button matSuffix color="primary"
                    [disabled]="form.get('account').errors || inLoad || countDown > 0"
                    (click)="getCode()">
                <ion-spinner name="dots" *ngIf="inLoad"></ion-spinner>
                <span *ngIf="!inLoad && !countDown">获取验证码</span>
                <span *ngIf="countDown">{{countDown}}秒后重试</span>
            </button>
        </mat-form-field>
        <mat-form-field class="width-100">
            <mat-label>验证码</mat-label>
            <span matPrefix>验证码 &nbsp;</span>
            <input matInput type="text"
                   formControlName="authCode">
            <button mat-icon-button matSuffix>
                <mat-icon>clear</mat-icon>
            </button>
        </mat-form-field>
        <mat-form-field class="width-100">
            <mat-label>新密码</mat-label>
            <span matPrefix>新密码 &nbsp;</span>
            <input matInput [type]="passwordHide ? 'password' : 'text'"
                   formControlName="password">
            <button mat-icon-button matSuffix (click)="passwordHide = !passwordHide"
                    [attr.aria-label]="'Hide password'" [attr.aria-pressed]="passwordHide">
                <mat-icon>{{passwordHide ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
            <mat-error *ngIf="form.get('password').errors">
                密码不相等
            </mat-error>
        </mat-form-field>
        <mat-form-field class="width-100">
            <mat-label>确认新密码</mat-label>
            <span matPrefix>新密码 &nbsp;</span>
            <input matInput [type]="passwordHide ? 'password' : 'text'"
                   formControlName="confirmPassword">
            <button mat-icon-button matSuffix (click)="passwordHide = !passwordHide"
                    [attr.aria-label]="'Hide password'" [attr.aria-pressed]="passwordHide">
                <mat-icon>{{passwordHide ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
            <mat-error *ngIf="form.get('confirmPassword').errors">
                至少包含：数字、大小写或特殊字符
            </mat-error>
        </mat-form-field>
        
        <div class="example-button-row margin-top-20">
            <button class="width-100" mat-raised-button color="primary" [disabled]="!form.valid"
                    (click)="commitChanges()">确认修改
            </button>
            
            <p>
                密码至少为7位，字符至少包含三类：数字、大小写字母或特殊字符
            </p>
            <p *ngIf="resultMsg">
                {{resultMsg}}
            </p>
        
        </div>
    </form>
</ion-content>
